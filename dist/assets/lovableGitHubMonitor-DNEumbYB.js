function e(){if("undefined"==typeof window)return!1;const e=window.location.hostname;return e.includes("lovable.app")||e.includes("lovable.dev")||e.includes("lovableproject.com")||e.includes(".lovable.")}function n(){if("undefined"==typeof document)return!1;const e=null!==document.querySelector("[data-lovable-component]"),n=null!==document.querySelector("[data-lovable-id]");return e||n}function t(){const t=[];!n()&&e()&&t.push({status:"warning",message:"Lovable component tagger not detected",fixInstructions:'Ensure LOVABLE_COMPONENT_TAGGER environment variable is set to "true" or run in dev mode',technicalDetails:{envVar:"LOVABLE_COMPONENT_TAGGER",expectedValue:"true",location:"vite.config.ts"}}),e()&&t.push({status:"healthy",message:"Running in Lovable preview environment",technicalDetails:{hostname:"undefined"!=typeof window?window.location.hostname:"unknown",isPreview:!0}});const o="undefined"!=typeof document?document.querySelectorAll('[data-lovable-lock="permanent"]'):[];o.length>0&&t.push({status:"error",message:`Found ${o.length} elements with permanent locks that prevent Lovable editing`,fixInstructions:'Change data-lovable-lock from "permanent" to "structure-only" in layoutGuard.ts',technicalDetails:{lockedElementCount:o.length,recommendedLockLevel:"structure-only",location:"src/lib/layoutGuard.ts"}});const s="undefined"!=typeof document?document.querySelectorAll('[data-lovable-lock="structure-only"]'):[];return s.length>0&&t.push({status:"healthy",message:`Found ${s.length} elements with structure-only locks (allows styling)`,technicalDetails:{lockLevel:"structure-only",elementsProtected:s.length}}),t}async function o(){const e=t().some(e=>"error"===e.status&&e.message.includes("permanent locks")),n={isConnected:!e,hasWritePermissions:!0,hasPRPermissions:!0,hasWorkflowPermissions:!0,diagnostics:{repositoryAccessible:!0,branchProtectionActive:!0,workflowsEnabled:!0,tokenValid:!e}};return e&&(n.errorMessage="Permanent layout locks detected - Lovable cannot modify locked elements"),n}function s(e){return e.isConnected?e.hasWritePermissions?e.hasPRPermissions?e.hasWorkflowPermissions?"âœ… GitHub connection healthy. Lovable can save changes.":"âš ï¸ Lovable GitHub App lacks workflow permissions. Some features may not work.":"âš ï¸ Lovable GitHub App lacks pull request permissions. Please update app permissions.":"âš ï¸ Lovable GitHub App lacks write permissions. Please reinstall the GitHub App.":"âš ï¸ GitHub connection issue detected. Permanent locks preventing Lovable from saving changes."}function a(e){const n=[];e.find(e=>"error"===e.status&&e.message.includes("permanent locks"))&&n.push("1. Fix permanent layout locks:","   - Open src/lib/layoutGuard.ts",'   - Change data-lovable-lock="permanent" to data-lovable-lock="structure-only"',"   - Commit and push changes");return e.find(e=>"warning"===e.status&&e.message.includes("component tagger"))&&n.push("2. Enable Lovable component tagger:","   - Set LOVABLE_COMPONENT_TAGGER=true in environment","   - Or run in development mode (npm run dev)"),0===n.length&&n.push("If Lovable keeps asking to reconnect:","1. Go to Lovable project settings","2. Disconnect GitHub integration","3. Reconnect and authorize all permissions:","   âœ“ Read access to code","   âœ“ Write access to code","   âœ“ Read and write access to pull requests","   âœ“ Read and write access to workflows","4. Ensure branch protection allows Lovable bot to push","5. Check that auto-merge workflow is enabled"),n}function l(){if(!e())return;console.group("ðŸ” Lovable GitHub Connection Health Check");const n=t();n.forEach(e=>{e.status;e.message,e.fixInstructions&&e.fixInstructions,e.technicalDetails&&e.technicalDetails});if(n.some(e=>"error"===e.status)){console.group("ðŸ“‹ Reconnection Instructions:");a(n).forEach(e=>console.log(e)),console.groupEnd()}console.groupEnd(),o().then(e=>{s(e)})}export{o as checkGitHubPermissions,s as getConnectionStatusMessage,a as getReconnectionInstructions,l as initializeGitHubHealthMonitor,e as isLovablePreview,n as isLovableTaggerActive,t as validateLovableEnvironment};
