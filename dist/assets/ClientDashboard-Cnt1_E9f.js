const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NewDashboard-CvmS-_no.js","assets/react-query-1zeL9f71.js","assets/react-vendor-BIu81k28.js","assets/index-C2YmphIk.js","assets/radix-primitives-Di8eIdiq.js","assets/radix-overlays-68Wd_bDx.js","assets/supabase-Ds_TnZEi.js","assets/react-router-BwMFiyVe.js","assets/radix-forms-KIAltt28.js","assets/index-Bh3aufmq.css","assets/calendar-DCy-VCIY.js","assets/circle-check-s2OpOxn4.js","assets/switch-Q96SPJnB.js","assets/house-D4CF2khR.js","assets/refresh-cw-BNU7USx8.js"])))=>i.map(i=>d[i]);
import{e,y as s,j as a,C as r,g as t,a as l,_ as n,J as c,K as i,i as o,A as d,D as m,T as h,E as u,F as x}from"./index-C2YmphIk.js";import{j}from"./react-query-1zeL9f71.js";import{r as f}from"./react-vendor-BIu81k28.js";import{H as w}from"./house-D4CF2khR.js";import{R as p}from"./refresh-cw-BNU7USx8.js";import{u as N}from"./react-router-BwMFiyVe.js";const g=new Map,b=new Map;const y=async()=>{try{const{data:a,error:r}=await s.functions.invoke("dashboard-summary",{body:{},headers:{"Content-Type":"application/json"}});if(r)throw e.report({type:"error",message:`Dashboard API error: ${r.message||"Unknown error"}`,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:e.getEnvironment(),metadata:{error:r}}),new Error(`Dashboard API failed: ${r.message||"Unknown error"}`);if(!a)throw new Error("No data returned from dashboard API");return a}catch(a){throw e.report({type:"error",message:`Dashboard fetch error: ${a instanceof Error?a.message:"Unknown error"}`,stack:a instanceof Error?a.stack:void 0,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:e.getEnvironment(),metadata:{error:a}}),a}},v=()=>{const{data:s,error:a,isLoading:r,isRefetching:t,refetch:l,invalidate:n,isStale:c}=function(e,s,a={}){const{cacheTime:r=3e5,staleTime:t=3e4,refetchOnWindowFocus:l=!0,retryAttempts:n=3}=a,[c,i]=f.useState(null),[o,d]=f.useState(null),[m,h]=f.useState(!0),[u,x]=f.useState(!1),j=f.useRef(0),w=f.useRef(null),p=f.useCallback(e=>{const s=g.get(e);return s?Date.now()-s.timestamp>s.ttl?(g.delete(e),null):s.data:null},[]),N=f.useCallback((e,s)=>{g.set(e,{data:s,timestamp:Date.now(),ttl:r})},[r]),y=f.useCallback(e=>{const s=g.get(e);return!s||Date.now()-s.timestamp>t},[t]),v=f.useCallback(async(a=!1)=>{var r,t;a?x(!0):h(!0);const l=b.get(e);if(l&&!a)try{const e=await l;return i(e),d(null),void h(!1)}catch(o){}w.current&&w.current.abort(),w.current=new AbortController;try{if(!a){const s=p(e);if(s&&!y(e))return i(s),d(null),void h(!1)}const t=s();b.set(e,t);const l=await t;if(null==(r=w.current)?void 0:r.signal.aborted)return;i(l),d(null),N(e,l),j.current=0}catch(o){if(null==(t=w.current)?void 0:t.signal.aborted)return;const s=o instanceof Error?o:new Error("Unknown error");if(j.current<n){j.current++;const e=Math.min(1e3*Math.pow(2,j.current-1),1e4);return void setTimeout(()=>{v(a)},e)}d(s);const r=p(e);r&&!c&&i(r)}finally{if(b.delete(e),h(!1),x(!1),g.size>50){const e=Array.from(g.entries()),s=Date.now(),a=e.sort((e,s)=>e[1].timestamp-s[1].timestamp);for(let r=0;r<e.length-50;r++)g.delete(a[r][0]);e.forEach(([e,a])=>{s-a.timestamp>18e5&&g.delete(e)})}}},[e,s,p,N,y,n,c]),k=f.useCallback(()=>(j.current=0,v(!0)),[v]),A=f.useCallback(()=>{g.delete(e),k()},[e,k]);return f.useEffect(()=>(v(),()=>{w.current&&w.current.abort()}),[v]),f.useEffect(()=>{if(!l)return;const s=()=>{y(e)&&k()};return window.addEventListener("focus",s),()=>window.removeEventListener("focus",s)},[l,y,e,k]),{data:c,error:o,isLoading:m,isRefetching:u,refetch:k,invalidate:A,isStale:y(e)}}("dashboard-summary",y,{cacheTime:3e5,staleTime:6e4,refetchOnWindowFocus:!0,retryAttempts:3}),i=f.useCallback(s=>{if(!s)return"Unknown";try{const e=new Date,a=new Date(s),r=e.getTime()-a.getTime(),t=Math.floor(r/6e4);if(t<1)return"Just now";if(t<60)return`${t}m ago`;const l=Math.floor(t/60);if(l<24)return`${l}h ago`;return`${Math.floor(l/24)}d ago`}catch(a){return e.report({type:"error",message:`Date parsing error: ${a instanceof Error?a.message:"Unknown error"}`,stack:a instanceof Error?a.stack:void 0,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:e.getEnvironment(),metadata:{isoString:s,error:a}}),"Unknown"}},[]),o=f.useCallback(()=>a?a.message.includes("Failed to fetch")||a.message.includes("network")?"Couldn't refresh right now. Check your connection":a.message.includes("timeout")?"Taking longer than usual. We'll keep trying":a.message.includes("No data returned")?"Dashboard service is starting up. Please wait":"Something's not quite right. We're looking into it":"",[a]),d=(null==s?void 0:s.lastUpdated)?`Last updated ${i(s.lastUpdated)}`:"",m=f.useCallback(()=>{n()},[n]);return{kpis:(null==s?void 0:s.kpis)||[],nextItems:(null==s?void 0:s.nextItems)||[],transcripts:(null==s?void 0:s.transcripts)||[],isLoading:r,isRefetching:t,error:a?o():null,lastUpdated:d,refresh:l,forceRefresh:m,hasData:!!s,isStale:c}};function k({className:e,...s}){return j.jsx("div",{className:a("animate-pulse rounded-md bg-muted",e),...s})}const A=({layout:e="comfortable"})=>{const s="compact"===e?"space-y-4":"spacious"===e?"space-y-8":"space-y-6",a="compact"===e?"gap-3":"spacious"===e?"gap-6":"gap-4";return j.jsxs("div",{className:s,children:[j.jsx("div",{className:"rounded-lg border bg-card p-6",children:j.jsxs("div",{className:"flex items-start justify-between",children:[j.jsxs("div",{className:"space-y-3 flex-1",children:[j.jsx(k,{className:"h-8 w-64"}),j.jsx(k,{className:"h-4 w-96"})]}),j.jsx(k,{className:"h-10 w-10 rounded-full"})]})}),j.jsx("div",{className:`grid grid-cols-2 md:grid-cols-4 ${a}`,children:Array.from({length:4}).map((e,s)=>j.jsx(r,{className:"relative overflow-hidden border-0 shadow-sm",children:j.jsxs(t,{className:"p-4",children:[j.jsxs("div",{className:"flex items-start justify-between mb-3",children:[j.jsx(k,{className:"h-10 w-10 rounded-md"}),j.jsx(k,{className:"h-5 w-12"})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(k,{className:"h-8 w-20"}),j.jsx(k,{className:"h-4 w-32"}),j.jsx(k,{className:"h-3 w-28"})]})]})},s))}),j.jsxs("div",{className:`grid grid-cols-1 lg:grid-cols-3 ${a}`,children:[j.jsxs("div",{className:`lg:col-span-2 ${s}`,children:[j.jsxs(r,{className:"shadow-sm",children:[j.jsx(l,{className:"border-b",children:j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsx(k,{className:"h-6 w-32"}),j.jsx(k,{className:"h-5 w-5 rounded-full"})]})}),j.jsx(t,{className:"p-4",children:j.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((e,s)=>j.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-md bg-muted/30",children:[j.jsx(k,{className:"h-5 w-5 rounded-full"}),j.jsxs("div",{className:"flex-1 space-y-2",children:[j.jsx(k,{className:"h-4 w-3/4"}),j.jsx(k,{className:"h-3 w-1/2"})]}),j.jsx(k,{className:"h-8 w-20 rounded-md"})]},s))})})]}),j.jsxs(r,{className:"shadow-sm",children:[j.jsx(l,{className:"border-b",children:j.jsx(k,{className:"h-6 w-40"})}),j.jsx(t,{className:"p-4",children:j.jsx("div",{className:"space-y-3",children:Array.from({length:2}).map((e,s)=>j.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-md bg-muted/20",children:[j.jsx(k,{className:"h-8 w-8 rounded-full"}),j.jsxs("div",{className:"flex-1 space-y-2",children:[j.jsx(k,{className:"h-4 w-full"}),j.jsx(k,{className:"h-3 w-3/4"})]})]},s))})})]}),j.jsxs(r,{className:"shadow-sm",children:[j.jsx(l,{className:"border-b",children:j.jsx(k,{className:"h-6 w-36"})}),j.jsx(t,{className:"p-4",children:j.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((e,s)=>j.jsxs("div",{className:"space-y-2 pb-4 border-b last:border-0",children:[j.jsxs("div",{className:"flex items-start justify-between",children:[j.jsx(k,{className:"h-5 w-32"}),j.jsx(k,{className:"h-4 w-20"})]}),j.jsx(k,{className:"h-3 w-full"}),j.jsx(k,{className:"h-3 w-4/5"}),j.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[j.jsx(k,{className:"h-6 w-16 rounded-full"}),j.jsx(k,{className:"h-6 w-20 rounded-full"})]})]},s))})})]})]}),j.jsxs("div",{className:s,children:[j.jsxs(r,{className:"shadow-sm",children:[j.jsx(l,{className:"border-b",children:j.jsx(k,{className:"h-6 w-32"})}),j.jsx(t,{className:"p-4",children:j.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((e,s)=>j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx(k,{className:"h-10 w-10 rounded-md"}),j.jsxs("div",{className:"flex-1 space-y-2",children:[j.jsx(k,{className:"h-4 w-28"}),j.jsx(k,{className:"h-3 w-36"})]})]},s))})})]}),j.jsxs(r,{className:"shadow-sm",children:[j.jsx(l,{className:"border-b",children:j.jsx(k,{className:"h-6 w-32"})}),j.jsx(t,{className:"p-4",children:j.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((e,s)=>j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx(k,{className:"h-2 w-2 rounded-full"}),j.jsx(k,{className:"h-4 w-24"})]}),j.jsx(k,{className:"h-5 w-20 rounded-full"})]},s))})})]}),j.jsxs(r,{className:"shadow-sm border-primary/20 bg-primary/5",children:[j.jsx(l,{className:"border-b border-primary/10",children:j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(k,{className:"h-5 w-5 rounded-full"}),j.jsx(k,{className:"h-5 w-24"})]})}),j.jsx(t,{className:"p-4",children:j.jsxs("div",{className:"space-y-3",children:[j.jsx(k,{className:"h-4 w-full"}),j.jsx(k,{className:"h-4 w-5/6"}),j.jsx(k,{className:"h-8 w-28 rounded-md mt-3"})]})})]})]})]}),j.jsxs("div",{className:"text-center py-4",children:[j.jsxs("div",{className:"inline-flex items-center gap-3 px-4 py-2 rounded-full bg-muted/50",children:[j.jsx("div",{className:"h-4 w-4 border-2 border-primary border-t-transparent rounded-full animate-spin"}),j.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading your dashboard..."})]}),j.jsx("p",{className:"text-xs text-muted-foreground/70 mt-2",children:"This usually takes a few seconds"})]})]})},D=f.lazy(()=>n(()=>import("./NewDashboard-CvmS-_no.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])).then(e=>({default:e.NewDashboard}))),E=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const e=N(),{error:s,lastUpdated:a,refresh:r}=v(),{dashboardLayout:t}=c();return j.jsxs("div",{className:"min-h-screen bg-background",children:[j.jsxs("div",{className:"container mx-auto px-4 py-8",children:[j.jsxs("div",{className:"flex items-center justify-between mb-8",children:[j.jsxs("div",{className:"flex items-center gap-4",children:[j.jsx(i,{}),j.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Dashboard"})]}),j.jsxs(o,{onClick:()=>e(d.home),variant:"outline",className:"flex items-center gap-2",children:[j.jsx(w,{className:"h-4 w-4"}),"Back to Home"]})]}),s&&j.jsxs(m,{className:"mb-6 border-yellow-200 bg-yellow-50 dark:border-yellow-800 dark:bg-yellow-900/20",children:[j.jsx(h,{className:"h-4 w-4 text-amber-800 dark:text-yellow-400"}),j.jsxs(u,{className:"flex items-center justify-between",children:[j.jsx("span",{className:"text-yellow-800 dark:text-yellow-300",children:s}),j.jsxs(o,{onClick:r,variant:"outline",size:"sm",className:"ml-4 h-auto px-3 py-1 text-xs",children:[j.jsx(p,{className:"h-3 w-3 mr-1"}),"Try again"]})]})]}),a&&j.jsx("div",{className:"text-xs text-muted-foreground mb-6 text-center",children:a}),j.jsx(f.Suspense,{fallback:j.jsx(A,{layout:t||"comfortable"}),children:j.jsx(D,{})})]}),j.jsx(x,{})]})}},Symbol.toStringTag,{value:"Module"}));export{E as C,k as S,v as u};
