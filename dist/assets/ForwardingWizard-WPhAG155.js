import{j as e}from"./react-query-1zeL9f71.js";import{r as a}from"./react-vendor-BIu81k28.js";import{z as r,y as t}from"./index-C2YmphIk.js";import"./radix-primitives-Di8eIdiq.js";import"./radix-overlays-68Wd_bDx.js";import"./supabase-Ds_TnZEi.js";import"./react-router-BwMFiyVe.js";import"./radix-forms-KIAltt28.js";const i="+18336062247";function n(){const[n,l]=a.useState("+1"),[o,d]=a.useState(""),[c,u]=a.useState("ROGERS_FIDO"),[f,p]=a.useState("idle"),[m,v]=a.useState("Ready to verify."),[x,h]=a.useState(null),b=a.useMemo(()=>{switch(c){case"ROGERS_FIDO":case"TELUS_KOODO":return{activateHref:`tel:*21*${i}#`,deactivateHref:"tel:##21#",instructions:"Tap from the device owning the number (GSM *21* / ##21#)."};case"BELL_MOBILITY":return{instructions:`Open Phone → Settings → Call Forwarding → Always forward → set ${i}.`};default:return{instructions:`From handset: Dial *72, then ${i}. If busy/no answer, repeat once. Disable with *73.`}}},[c]);return a.useEffect(()=>{if(!x||"pending"!==f)return;if(!r)return void v("Supabase disabled in this environment. Verify manually via inbound call logs.");let e=!1;const a=setInterval(async()=>{const{data:r,error:i}=await t.from("forwarding_checks").select("status, notes").eq("id",x).maybeSingle();if(e)return;if(i)return console.error("Forwarding status poll failed",i),void v(i.message??"Unable to poll verification status.");if(!r)return;p(r.status);const n=r.notes?` — ${r.notes}`:"";"verified"===r.status?(v(`Verified via inbound forwarding${n}`),clearInterval(a)):"failed"===r.status?(v(`Verification failed${n}`),clearInterval(a)):v(`Awaiting forwarded inbound${n}`)},4e3);return()=>{e=!0,clearInterval(a)}},[x,f]),e.jsxs("div",{className:"p-6 max-w-3xl mx-auto space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Forwarding Wizard"}),e.jsx("div",{className:"space-x-2",children:["ROGERS_FIDO","TELUS_KOODO","BELL_MOBILITY","LANDLINE"].map(a=>e.jsx("button",{onClick:()=>u(a),className:"px-3 py-2 rounded-xl border "+(c===a?"bg-black text-white":"bg-white"),children:a.replace("_","/")},a))}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-sm",children:"Client’s current (old) number (E.164):"}),e.jsx("input",{className:"border rounded-xl px-3 py-2",value:n,onChange:e=>l(e.target.value),placeholder:"+1XXXXXXXXXX"}),e.jsx("label",{className:"text-sm",children:"Org Id (UUID):"}),e.jsx("input",{className:"border rounded-xl px-3 py-2",value:o,onChange:e=>d(e.target.value),placeholder:"UUID"})]}),e.jsxs("div",{className:"rounded-2xl border p-4 space-y-3",children:[e.jsx("h2",{className:"font-semibold",children:"Activate forwarding"}),e.jsx("p",{className:"text-sm",children:b.instructions}),e.jsxs("div",{className:"flex gap-3",children:["activateHref"in b&&b.activateHref?e.jsx("a",{className:"px-4 py-2 rounded-xl border",href:b.activateHref,children:"Activate"}):null,"deactivateHref"in b&&b.deactivateHref?e.jsx("a",{className:"px-4 py-2 rounded-xl border",href:b.deactivateHref,children:"Deactivate"}):null]})]}),e.jsxs("div",{className:"rounded-2xl border p-4 space-y-3",children:[e.jsx("h2",{className:"font-semibold",children:"Auto-verification"}),e.jsx("button",{onClick:async function(){var e;const a=o||"00000000-0000-0000-0000-000000000000";p("pending"),v("Placing a short test call to the old number; awaiting forwarded inbound…");try{const r=await fetch("https://hysvqdwmhxnblxfqnszn.supabase.co/functions/v1/forwarding-verify-start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({org_id:a,old_number_e164:n})}),t=await r.json().catch(()=>({}));if(!r.ok){p("failed");const a=(null==(e=null==t?void 0:t.error)?void 0:e.message)??(null==t?void 0:t.error)??"Verification start failed";return void v("string"==typeof a?a:"Verification start failed")}h((null==t?void 0:t.check_id)??null),p((null==t?void 0:t.status)||"pending"),v("Verification pending (~20s). When forwarding is active, inbound will mark Verified.")}catch(r){console.error("Verification start failed",r),p("failed"),v(r instanceof Error?r.message:"Verification start failed")}},className:"px-4 py-2 rounded-xl border",children:"Place test call & verify"}),e.jsxs("div",{className:"text-sm",children:["Status: ",e.jsx("b",{children:f})," — ",m]})]}),e.jsx(s,{})]})}function s(){const[r,t]=a.useState("+1"),[i,n]=a.useState(""),[s,l]=a.useState("Twilio will place a quick call to confirm ownership.");return e.jsxs("div",{className:"rounded-2xl border p-4 space-y-2",children:[e.jsx("h2",{className:"font-semibold",children:"Outbound Caller ID (show legacy number)"}),e.jsx("input",{className:"border rounded-xl px-3 py-2 w-full",value:r,onChange:e=>t(e.target.value),placeholder:"+1XXXXXXXXXX"}),e.jsx("input",{className:"border rounded-xl px-3 py-2 w-full",value:i,onChange:e=>n(e.target.value),placeholder:"Label (optional)"}),e.jsx("button",{onClick:async function(){var e,a;try{const t=await fetch("https://hysvqdwmhxnblxfqnszn.supabase.co/functions/v1/callerid-verify-start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_number_e164:r,friendly_name:i})}),n=await t.json();if(!t.ok)return void l("Error: "+((null==(e=null==n?void 0:n.error)?void 0:e.message)??(null==n?void 0:n.error)??"unknown"));const s=null==(a=null==n?void 0:n.data)?void 0:a.validation_code;l(`Twilio will call ${r}. Enter code ${s} to complete verification.`)}catch(t){console.error("Caller ID verification failed",t),l("Error: "+(t instanceof Error?t.message:"unknown"))}},className:"px-4 py-2 rounded-xl border",children:"Verify caller ID"}),e.jsx("div",{className:"text-sm",children:s})]})}export{n as default};
