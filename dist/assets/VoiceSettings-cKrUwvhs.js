import{j as e}from"./react-query-1zeL9f71.js";import{r as s}from"./react-vendor-BIu81k28.js";import{j as l,n as a,y as i,i as n,T as r,D as c,E as t,C as d,a as o,d as m,m as u,f as x,g as h,L as p,q as j,a0 as v,I as g,Z as f,B as _,V as b,S as y}from"./index-C2YmphIk.js";import{S as N,a as w,b as k,c as S,d as A}from"./select-D7yvCqdH.js";import{b as C,T as M,c as V,d as B}from"./radix-forms-KIAltt28.js";import{S as P}from"./switch-Q96SPJnB.js";import{T as R,a as T,b as D,c as E}from"./tabs-WdgLnVcG.js";import{M as I}from"./message-square-DLm0ufib.js";import"./radix-primitives-Di8eIdiq.js";import"./radix-overlays-68Wd_bDx.js";import"./supabase-Ds_TnZEi.js";import"./react-router-BwMFiyVe.js";const F=s.forwardRef(({className:s,...a},i)=>e.jsxs(C,{ref:i,className:l("relative flex w-full touch-none select-none items-center",s),...a,children:[e.jsx(M,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(V,{className:"absolute h-full bg-primary"})}),e.jsx(B,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));F.displayName=C.displayName;const L=[{value:"alloy",label:"Alloy (Neutral)"},{value:"echo",label:"Echo (Male)"},{value:"fable",label:"Fable (British Male)"},{value:"onyx",label:"Onyx (Deep Male)"},{value:"nova",label:"Nova (Female)"},{value:"shimmer",label:"Shimmer (Warm Female)"}];function H(){var l;const[C,M]=s.useState(null),[V,B]=s.useState([]),[H,O]=s.useState(!0),[Y,q]=s.useState(!1);s.useState(!1);const[U,z]=s.useState(!1),{toast:G}=a();s.useEffect(()=>{W(),Z()},[]);const W=async()=>{try{const{data:e,error:s}=await i.from("voice_config").select("*").single();if(s&&"PGRST116"!==s.code)throw s;M(e||{pickup_mode:"immediate",rings_before_pickup:2,llm_enabled:!0,llm_voice:"alloy",llm_speaking_rate:1,llm_max_reply_seconds:15,system_prompt:"",amd_enable:!0,ringback_tone:"default",max_ring_reroutes:3,fail_open:!1,business_name:"Apex Business Systems",human_number_e164:"+14319900222",active_preset_id:null}),z("never"===(null==e?void 0:e.pickup_mode)&&!(null==e?void 0:e.llm_enabled))}catch(e){G({title:"Failed to load config",description:e.message,variant:"destructive"})}finally{O(!1)}},Z=async()=>{try{const{data:e,error:s}=await i.from("voice_presets").select("*").order("id");if(s)throw s;B(e||[])}catch(e){console.error("Failed to load presets:",e)}},K=async e=>{if(Y)return;const s=C,l={...C,...e};q(!0),M(l);try{const{data:e,error:s}=await i.functions.invoke("ops-voice-config-update",{body:l});if(s)throw s;(null==e?void 0:e.ok)||console.warn("Voice config update responded without ok flag",e),G({title:"Settings Saved",description:"Voice configuration updated successfully"})}catch(a){console.error("Failed to save voice configuration",a),M(s),G({title:"Save Failed",description:(null==a?void 0:a.message)??"Unable to save changes right now.",variant:"destructive"})}finally{q(!1)}},Q=e=>e.replace(/\{BusinessName\}/g,(null==C?void 0:C.business_name)||"Apex Business Systems").replace(/\{HumanNumberE164\}/g,(null==C?void 0:C.human_number_e164)||"+14319900222");return H?e.jsx("div",{className:"container max-w-6xl py-8",children:"Loading..."}):e.jsxs("div",{className:"container max-w-6xl py-8 space-y-6","aria-busy":Y,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Voice Settings"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Configure AI voice assistant and call handling"})]}),e.jsxs(n,{variant:U?"default":"destructive",size:"lg",onClick:async()=>{const e=!U;z(e),await K({pickup_mode:"never",llm_enabled:!1}),G({title:e?"ðŸš¨ Panic Mode Activated":"Panic Mode Deactivated",description:e?"All calls will be bridged directly. No LLM processing.":"Voice AI settings restored",variant:e?"destructive":"default"})},className:"gap-2",children:[e.jsx(r,{className:"w-5 h-5"}),U?"Exit Panic Mode":"ðŸš¨ Panic: Bridge All Calls"]})]}),U&&e.jsxs(c,{variant:"destructive",children:[e.jsx(r,{className:"h-4 w-4"}),e.jsxs(t,{children:[e.jsx("strong",{children:"Panic Mode Active:"})," All calls are being bridged directly to ",(null==C?void 0:C.ring_target)||"+14319900222",". LLM processing is disabled."]})]}),e.jsxs(R,{defaultValue:"basic",className:"space-y-6",children:[e.jsxs(T,{className:"grid w-full grid-cols-3",children:[e.jsx(D,{value:"basic",children:"Basic Settings"}),e.jsx(D,{value:"presets",children:"Quick Presets"}),e.jsx(D,{value:"advanced",children:"Advanced"})]}),e.jsxs(E,{value:"basic",className:"space-y-6",children:[e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5"}),"Pickup Mode"]}),e.jsx(x,{children:"When should the AI answer incoming calls?"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Mode"}),e.jsxs(N,{value:null==C?void 0:C.pickup_mode,onValueChange:e=>K({pickup_mode:e}),children:[e.jsx(w,{children:e.jsx(k,{})}),e.jsxs(S,{children:[e.jsx(A,{value:"immediate",children:"Immediate (AI answers right away)"}),e.jsx(A,{value:"after_rings",children:"After N Rings (try human first)"}),e.jsx(A,{value:"never",children:"Never (bridge only)"})]})]})]}),"after_rings"===(null==C?void 0:C.pickup_mode)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{children:["Rings Before Pickup: ",null==C?void 0:C.rings_before_pickup]}),e.jsx(F,{value:[(null==C?void 0:C.rings_before_pickup)||2],onValueChange:([e])=>K({rings_before_pickup:e}),min:1,max:6,step:1,className:"w-full"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["~",5*((null==C?void 0:C.rings_before_pickup)||2)," seconds"]})]})]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"Voice & Speech"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Enable LLM Voice"}),e.jsx(P,{checked:null==C?void 0:C.llm_enabled,onCheckedChange:e=>K({llm_enabled:e})})]}),(null==C?void 0:C.llm_enabled)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Voice"}),e.jsxs(N,{value:null==C?void 0:C.llm_voice,onValueChange:e=>K({llm_voice:e}),children:[e.jsx(w,{children:e.jsx(k,{})}),e.jsx(S,{children:L.map(s=>e.jsx(A,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{children:["Speaking Rate: ",null==(l=null==C?void 0:C.llm_speaking_rate)?void 0:l.toFixed(1),"x"]}),e.jsx(F,{value:[(null==C?void 0:C.llm_speaking_rate)||1],onValueChange:([e])=>K({llm_speaking_rate:e}),min:.5,max:2,step:.1,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{children:["Max Reply Length: ",null==C?void 0:C.llm_max_reply_seconds,"s"]}),e.jsx(F,{value:[(null==C?void 0:C.llm_max_reply_seconds)||15],onValueChange:([e])=>K({llm_max_reply_seconds:e}),min:5,max:30,step:1,className:"w-full"})]})]})]})]}),e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsx(m,{children:"System Prompt"}),e.jsx(x,{children:"Instructions for how the AI should behave"})]}),e.jsx(h,{children:e.jsx(j,{value:(null==C?void 0:C.system_prompt)||"",onChange:e=>M({...C,system_prompt:e.target.value}),onBlur:()=>K({system_prompt:null==C?void 0:C.system_prompt}),rows:6,className:"font-mono text-sm"})})]})]}),e.jsxs(E,{value:"presets",className:"space-y-4",children:[e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Preset Tokens"]}),e.jsx(x,{children:"These tokens are replaced in all preset prompts"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Business Name"}),e.jsx(g,{value:(null==C?void 0:C.business_name)||"",onChange:e=>M({...C,business_name:e.target.value}),onBlur:()=>K({business_name:null==C?void 0:C.business_name}),placeholder:"Apex Business Systems"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Token: ","{BusinessName}"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Human Number (E.164)"}),e.jsx(g,{value:(null==C?void 0:C.human_number_e164)||"",onChange:e=>M({...C,human_number_e164:e.target.value}),onBlur:()=>K({human_number_e164:null==C?void 0:C.human_number_e164}),placeholder:"+14319900222"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Token: ","{HumanNumberE164}"]})]})]})]}),e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Prompt Presets"]}),e.jsx(x,{children:"One-click configurations with token replacement"})]}),e.jsx(h,{className:"space-y-3",children:V.map(s=>{const l=(null==C?void 0:C.active_preset_id)===s.id,a=Q(s.system_prompt);return e.jsxs(d,{className:l?"border-primary":"",children:[e.jsx(o,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"text-lg",children:s.label}),l&&e.jsxs(_,{variant:"default",className:"gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),"Active"]})]}),e.jsx(n,{size:"sm",onClick:()=>(async e=>{const s=V.find(s=>s.id===e);if(!s)return;const l=Q(s.system_prompt);await K({system_prompt:l,active_preset_id:e,llm_max_reply_seconds:s.max_reply_seconds,llm_speaking_rate:s.speaking_rate,llm_voice:s.voice}),G({title:"Preset Applied",description:`${s.label} preset is now active`})})(s.id),disabled:Y||l,children:l?"Applied":"Apply"})]})}),e.jsxs(h,{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx("strong",{children:"Preview (with tokens resolved):"})}),e.jsxs("div",{className:"text-xs bg-muted p-3 rounded-md font-mono whitespace-pre-wrap max-h-32 overflow-y-auto",children:[a.substring(0,300),a.length>300&&"..."]}),e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground pt-2",children:[e.jsxs("span",{children:["Voice: ",s.voice]}),e.jsxs("span",{children:["Rate: ",s.speaking_rate,"x"]}),e.jsxs("span",{children:["Max: ",s.max_reply_seconds,"s"]})]})]})]},s.id)})})]}),e.jsxs(c,{children:[e.jsx(y,{className:"h-4 w-4"}),e.jsxs(t,{children:[e.jsx("strong",{children:"Global Rules (applied to all presets):"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 text-sm space-y-1",children:[e.jsx("li",{children:"Stop recording if caller declines consent; continue with minimal notes"}),e.jsx("li",{children:"Silence â‰¥6s: brief nudge once; on second silence, bridge to human"}),e.jsx("li",{children:"Low confidence on â‰¥2 fields â†’ offer transfer"}),e.jsx("li",{children:"Email transcript with subject: [Call Transcript] CallerID YYYY-MM-DD HH:mm TZ"})]})]})]})]}),e.jsxs(E,{value:"advanced",className:"space-y-4",children:[e.jsxs(c,{children:[e.jsx(y,{className:"h-4 w-4"}),e.jsxs(t,{children:[e.jsx("strong",{children:"Advanced Settings:"})," These options affect low-level call handling behavior. Only modify if you understand the implications."]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"AMD & Detection"})}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Enable AMD (Answering Machine Detection)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Detect voicemail and skip"})]}),e.jsx(P,{checked:null==C?void 0:C.amd_enable,onCheckedChange:e=>K({amd_enable:e})})]})})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Ring Behavior"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Ring Target (E.164)"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border rounded-md",value:(null==C?void 0:C.ring_target)||"",onChange:e=>M({...C,ring_target:e.target.value}),onBlur:()=>K({ring_target:null==C?void 0:C.ring_target}),placeholder:"+14319900222"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{children:["Max Ring Reroutes: ",null==C?void 0:C.max_ring_reroutes]}),e.jsx(F,{value:[(null==C?void 0:C.max_ring_reroutes)||3],onValueChange:([e])=>K({max_ring_reroutes:e}),min:1,max:10,step:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Ringback Tone"}),e.jsxs(N,{value:null==C?void 0:C.ringback_tone,onValueChange:e=>K({ringback_tone:e}),children:[e.jsx(w,{children:e.jsx(k,{})}),e.jsxs(S,{children:[e.jsx(A,{value:"default",children:"Default"}),e.jsx(A,{value:"us",children:"US Standard"}),e.jsx(A,{value:"uk",children:"UK Standard"}),e.jsx(A,{value:"silence",children:"Silence"})]})]})]})]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Failure Handling"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Fail Open"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If AI fails, connect the call anyway"})]}),e.jsx(P,{checked:null==C?void 0:C.fail_open,onCheckedChange:e=>K({fail_open:e})})]})})]})]})]})]})}export{H as default};
