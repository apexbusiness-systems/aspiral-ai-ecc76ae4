import{j as e}from"./react-query-1zeL9f71.js";import{r as t,b as s}from"./react-vendor-BIu81k28.js";import{c as r,j as a,n,U as o,e as i}from"./index-C2YmphIk.js";import{M as l}from"./message-circle-CM7zeB0m.js";import{p as d,d as c,b as m}from"./performanceOptimizations-DPwb1cGZ.js";import"./radix-primitives-Di8eIdiq.js";import"./radix-overlays-68Wd_bDx.js";import"./supabase-Ds_TnZEi.js";import"./react-router-BwMFiyVe.js";import"./radix-forms-KIAltt28.js";
/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u=r("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]),h=r("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const x={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8",xl:"w-12 h-12"},f={sm:16,md:24,lg:32,xl:48},g=({size:s="md",className:r,alt:n="TradeLine 24/7 AI Assistant",...o})=>{const[i,d]=t.useState(!1);return i?e.jsx(l,{size:f[s],className:a(x[s],r),"aria-label":n}):e.jsx("img",{src:"/assets/brand/TRADELEINE_ROBOT_V2.svg",alt:n,className:a(x[s],"object-contain flex-shrink-0",r),loading:o.loading||"eager",onError:()=>d(!0),onLoad:()=>d(!1),...o})},p=e=>{const t=(new Date).getTime()-e.getTime(),s=Math.floor(t/6e4);return s<1?"Just now":s<60?`${s}m ago`:s<1440?`${Math.floor(s/60)}h ago`:e.toLocaleDateString()},b=s.memo(()=>{const[s,r]=t.useState(!1),[l,x]=t.useState([]),[f,b]=t.useState(""),[y,v]=t.useState(!1),j=t.useRef(null),w=t.useRef(null),N=t.useRef(null),{toast:k}=n(),I=t.useCallback(()=>{j.current&&(d()?j.current.scrollIntoView({behavior:"auto"}):j.current.scrollIntoView({behavior:"smooth"}))},[]),E=t.useMemo(()=>c(I,50),[I]);t.useEffect(()=>{m(E)},[l,E]),t.useEffect(()=>{s&&w.current&&w.current.focus()},[s]);const T=async()=>{if(!f.trim()||y)return;const e={id:crypto.randomUUID(),role:"user",content:f.trim(),timestamp:new Date};x(t=>[...t,e]),b(""),v(!0);const t=crypto.randomUUID(),s={id:t,role:"assistant",content:"",timestamp:new Date};x(e=>[...e,s]);try{l.length,await async function(e,t={}){var s,r,a,n;const{onChunk:o,onComplete:i,onError:l,signal:d}=t;try{const t=await fetch("https://hysvqdwmhxnblxfqnszn.supabase.co/functions/v1/chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh5c3ZxZHdtaHhuYmx4ZnFuc3puIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3MTQxMjcsImV4cCI6MjA3MjI5MDEyN30.cPgBYmuZh7o-stRDGGG0grKINWe9-RolObGmiqsdJfo"},body:JSON.stringify({messages:e}),signal:d});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const l=null==(s=t.body)?void 0:s.getReader();if(!l)throw new Error("No response body");const m=new TextDecoder;let u="";for(;;){const{done:e,value:t}=await l.read();if(e)break;const s=m.decode(t,{stream:!0}).split("\n");for(const l of s)if(l.startsWith("data: ")){const e=l.slice(6);if("[DONE]"===e)return null==i||i(u),u;try{const t=(null==(n=null==(a=null==(r=JSON.parse(e).choices)?void 0:r[0])?void 0:a.delta)?void 0:n.content)||"";t&&(u+=t,null==o||o(t))}catch(c){console.warn("Invalid JSON chunk:",e)}}}return null==i||i(u),u}catch(m){const e=m instanceof Error?m:new Error(String(m));throw null==l||l(e),e}}([...l,e].map(e=>({role:e.role,content:e.content})),{onChunk:e=>{x(s=>s.map(s=>s.id===t?{...s,content:s.content+e}:s))},onComplete:e=>{e.length,v(!1)},onError:e=>{var s,r;i.report({type:"error",message:`Chat stream error: ${e.message}`,stack:e.stack,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:i.getEnvironment(),metadata:{messageCount:l.length}}),console.error("Chat stream error:",e);let a="Sorry, I encountered an error. Please try again.";(null==(s=e.message)?void 0:s.includes("429"))?a="I'm receiving too many requests right now. Please wait a moment and try again.":(null==(r=e.message)?void 0:r.includes("402"))&&(a="The AI service is temporarily unavailable. Please try again later."),x(e=>e.map(e=>e.id===t?{...e,content:a}:e)),v(!1),k({title:"Chat Error",description:a,variant:"destructive"})}})}catch(r){console.error("Chat error:",r),v(!1)}};return t.useEffect(()=>{const e=e=>{"Escape"===e.key&&s&&r(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s]),t.useEffect(()=>()=>{N.current&&(clearTimeout(N.current),N.current=null)},[]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{r(!0),0===l.length&&(N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{const e={id:crypto.randomUUID(),role:"assistant",content:"Hello! I'm here to help you with questions about TradeLine 24/7's AI receptionist services. How can I assist you today?",timestamp:new Date};x([e]),N.current=null},300))},"aria-expanded":s,"aria-controls":"mini-chat-dialog",className:a("fixed right-4 bottom-4 sm:bottom-4 max-sm:bottom-20 z-[60] rounded-full shadow-lg","p-3 bg-primary hover:bg-primary/90 text-primary-foreground","transition-all duration-300 hover:scale-110 active:scale-95","flex items-center justify-center","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",!s&&"animate-bounce-subtle hover:animate-none"),children:[e.jsx("span",{className:"sr-only",children:"Open chat"}),e.jsx(g,{size:"md",className:"w-[22px] h-[22px] brightness-0 invert","aria-hidden":"true",loading:"eager"}),l.length>0&&!s&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-background animate-pulse","aria-label":"Unread messages"})]}),s&&e.jsxs("div",{id:"mini-chat-dialog",role:"dialog","aria-modal":"true","aria-labelledby":"mini-chat-title",className:"fixed right-4 bottom-20 z-[60] w-[360px] max-w-[90vw] h-[500px] rounded-2xl shadow-2xl bg-background/95 backdrop-blur-sm border border-border/50 flex flex-col animate-in slide-in-from-bottom-5 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-primary/5 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(g,{size:"sm",className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h2",{id:"mini-chat-title",className:"text-base font-semibold text-foreground",children:"TradeLine 24/7 Assistant"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Online • Usually replies instantly"})]})]}),e.jsx("button",{onClick:()=>{r(!1)},className:"text-muted-foreground hover:text-foreground transition-colors p-1 rounded-md hover:bg-accent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring","aria-label":"Minimize chat",children:e.jsx(u,{size:16})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 scroll-smooth",children:[0===l.length&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-8 px-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-4 animate-pulse",children:e.jsx(g,{size:"lg",className:"w-8 h-8"})}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:"Start a conversation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ask me anything about TradeLine 24/7"})]}),l.map((t,s)=>{const r=s>=l.length-3&&!d();return e.jsxs("div",{className:a("flex items-start gap-3","user"===t.role?"justify-end":"justify-start",r&&"animate-in fade-in slide-in-from-bottom-2 duration-300"),style:r?{animationDelay:`${Math.min(30*s,150)}ms`}:void 0,children:["assistant"===t.role&&e.jsx("div",{className:"w-7 h-7 rounded-full bg-primary flex items-center justify-center flex-shrink-0 overflow-hidden shadow-sm",children:e.jsx(g,{size:"sm",className:"w-4 h-4 brightness-0 invert"})}),e.jsxs("div",{className:"flex flex-col gap-1 max-w-[80%]",children:[e.jsx("div",{className:a("rounded-2xl px-4 py-2.5 text-sm leading-relaxed shadow-sm","user"===t.role?"bg-primary text-primary-foreground rounded-br-sm":"bg-muted text-foreground rounded-bl-sm"),children:e.jsx("p",{className:"whitespace-pre-wrap break-words",children:t.content})}),e.jsx("span",{className:a("text-xs text-muted-foreground px-2","user"===t.role?"text-right":"text-left"),children:p(t.timestamp)})]}),"user"===t.role&&e.jsx("div",{className:"w-7 h-7 rounded-full bg-muted flex items-center justify-center flex-shrink-0 shadow-sm",children:e.jsx(o,{size:14,className:"text-muted-foreground"})})]},t.id)}),y&&e.jsxs("div",{className:"flex items-start gap-3 animate-in fade-in duration-300",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-primary flex items-center justify-center flex-shrink-0 overflow-hidden shadow-sm",children:e.jsx(g,{size:"sm",className:"w-4 h-4 brightness-0 invert"})}),e.jsx("div",{className:"bg-muted text-foreground rounded-2xl rounded-bl-sm px-4 py-3 flex items-center gap-2 shadow-sm",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),e.jsx("div",{ref:j})]}),e.jsxs("div",{className:"p-4 border-t bg-gradient-to-t from-background to-background/95",children:[e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{ref:w,type:"text",value:f,onChange:e=>b(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),T())},placeholder:"Type your message...",disabled:y,className:a("w-full px-4 py-2.5 pr-10 border rounded-2xl bg-background text-foreground","placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent","disabled:opacity-50 disabled:cursor-not-allowed","transition-all duration-200",f.trim()&&"shadow-sm"),"aria-label":"Chat input"}),f.trim().length>0&&e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-muted-foreground",children:"Press Enter to send"})]}),e.jsx("button",{onClick:T,disabled:!f.trim()||y,className:a("px-4 py-2.5 bg-primary text-primary-foreground rounded-2xl","hover:bg-primary/90 active:scale-95","disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100","transition-all duration-200","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","shadow-sm hover:shadow-md"),"aria-label":"Send message",children:e.jsx(h,{size:18,className:a("transition-transform duration-200",f.trim()&&"translate-x-0.5 translate-y-0.5")})})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 px-1",children:["AI-powered responses • ",l.length>0&&`${l.length} message${1!==l.length?"s":""}`]})]})]})]})});export{b as MiniChat};
