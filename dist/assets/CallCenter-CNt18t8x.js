import{j as e}from"./react-query-1zeL9f71.js";import{c as r,y as a,e as t,P as s,N as l,m as n,C as i,a as o,d,g as c,i as m,B as u}from"./index-C2YmphIk.js";import{r as x}from"./react-vendor-BIu81k28.js";import{S as g}from"./SEOHead-DOOuV7QP.js";import{R as h}from"./refresh-cw-BNU7USx8.js";import{D as p}from"./download-C310cSUr.js";import{E as b}from"./external-link-aY3t7X6-.js";import"./radix-primitives-Di8eIdiq.js";import"./radix-overlays-68Wd_bDx.js";import"./supabase-Ds_TnZEi.js";import"./react-router-BwMFiyVe.js";import"./radix-forms-KIAltt28.js";
/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f=r("phone-missed",[["path",{d:"m16 2 6 6",key:"1gw87d"}],["path",{d:"m22 2-6 6",key:"6f0sa0"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),v=()=>{const[e,r]=x.useState([]),[s,l]=x.useState({totalCalls:0,completedCalls:0,missedCalls:0,averageDuration:0,answerRate:0}),[n,i]=x.useState(!0),[o,d]=x.useState(null),c=async()=>{try{i(!0);const{data:e,error:t}=await a.from("analytics_events").select("*").in("event_type",["twilio_call","twilio_call_status"]).order("created_at",{ascending:!1}).limit(100);if(t)throw t;const s=new Map;e&&e.forEach(e=>{const r=e.event_data,a=r.call_sid;if(a){const t=s.get(a),l={call_sid:a,from_number:r.from_number||r.From||"Unknown",to_number:r.to_number||r.To||"+15877428885",call_status:r.call_status||r.CallStatus||"unknown",duration:r.duration||r.CallDuration,direction:r.direction||"inbound",created_at:e.created_at,answered_by:r.answered_by||r.AnsweredBy,recording_url:r.recording_url||r.RecordingUrl};(!t||new Date(e.created_at)>new Date(t.created_at))&&s.set(a,l)}});const n=Array.from(s.values());r(n);const o=n.length,c=n.filter(e=>"completed"===e.call_status).length,m=n.filter(e=>["no-answer","busy","failed","canceled"].includes(e.call_status)).length,u=n.filter(e=>e.duration&&e.duration>0).map(e=>e.duration),x=u.length>0?Math.round(u.reduce((e,r)=>e+r,0)/u.length):0,g=o>0?Math.round(c/o*100):0;l({totalCalls:o,completedCalls:c,missedCalls:m,averageDuration:x,answerRate:g}),d(null)}catch(e){t.report({type:"error",message:`Error fetching Twilio call data: ${e instanceof Error?e.message:String(e)}`,stack:e instanceof Error?e.stack:void 0,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,environment:t.getEnvironment()}),d(e instanceof Error?e.message:"Failed to fetch call data")}finally{i(!1)}};return x.useEffect(()=>{c();const e=a.channel("twilio_calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"analytics_events",filter:"event_type=in.(twilio_call,twilio_call_status)"},()=>{c()}).subscribe();return()=>{e.unsubscribe()}},[]),{calls:e,stats:s,loading:n,error:o,refresh:c,formatDuration:e=>{if(!e)return"0:00";return`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`},formatTimeAgo:e=>{const r=new Date,a=new Date(e),t=r.getTime()-a.getTime(),s=Math.floor(t/6e4);if(s<1)return"Just now";if(s<60)return`${s}m ago`;const l=Math.floor(s/60);if(l<24)return`${l}h ago`;return`${Math.floor(l/24)}d ago`}}},j=()=>{const{stats:r,loading:a}=v(),t=[{title:"Total Calls",value:r.totalCalls.toString(),icon:s,color:"text-info",bgColor:"bg-blue-100 dark:bg-blue-900",description:"All incoming calls"},{title:"Answered",value:r.completedCalls.toString(),icon:l,color:"text-emerald-600",bgColor:"bg-emerald-100 dark:bg-emerald-900",description:"Successfully connected"},{title:"Missed",value:r.missedCalls.toString(),icon:f,color:"text-error",bgColor:"bg-red-100 dark:bg-red-900",description:"No answer or busy"},{title:"Avg Duration",value:`${Math.floor(r.averageDuration/60)}:${(r.averageDuration%60).toString().padStart(2,"0")}`,icon:n,color:"text-neutral",bgColor:"bg-purple-100 dark:bg-purple-900",description:"Average call time"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:t.map((t,s)=>{const l=t.icon;return e.jsxs(i,{className:"relative overflow-hidden border-0 bg-card/60 backdrop-blur-sm group hover:shadow-lg transition-all duration-300",style:{boxShadow:"var(--premium-shadow-subtle)",background:"linear-gradient(135deg, hsl(var(--card) / 0.8) 0%, hsl(var(--card) / 0.6) 100%)",border:"1px solid hsl(var(--premium-border))"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none"}),e.jsxs(o,{className:"relative z-10 flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:t.title}),e.jsx("div",{className:`p-2 rounded-xl ${t.bgColor}/10`,children:e.jsx(l,{className:`h-4 w-4 ${t.color}`})})]}),e.jsxs(c,{className:"relative z-10",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground group-hover:text-primary/90 transition-colors",children:a?"...":t.value}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.description}),"Answered"===t.title&&r.totalCalls>0&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:`text-xs font-medium ${t.color}`,children:[r.answerRate,"% answer rate"]})})]})]},t.title)})})},w=e=>{switch(e){case"completed":return"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200";case"ringing":case"in-progress":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"no-answer":case"busy":case"failed":case"canceled":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-muted text-muted-foreground"}};function N(){const{calls:r,loading:a,error:t,refresh:n,formatDuration:x,formatTimeAgo:f}=v();return e.jsxs(e.Fragment,{children:[e.jsx(g,{title:"Calls Dashboard - TradeLine 24/7",description:"Monitor and manage your Twilio voice calls with real-time statistics and call history.",keywords:"call center, Twilio, voice calls, call monitoring, phone system"}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Calls Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitor and manage your Twilio voice calls in real-time"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:n,disabled:a,className:"flex items-center space-x-2",children:[e.jsx(h,{className:"h-4 w-4 "+(a?"animate-spin":"")}),e.jsx("span",{children:"Refresh"})]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{if(0===r.length)return;const e=[["Call ID","From","To","Status","Duration","Date","Direction"].join(","),...r.map(e=>[e.call_sid,e.from_number,e.to_number,e.call_status,x(e.duration),new Date(e.created_at).toLocaleString(),e.direction].join(","))].join("\n"),a=new Blob([e],{type:"text/csv"}),t=window.URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download=`twilio-calls-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(t)},disabled:0===r.length,className:"flex items-center space-x-2",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx("span",{children:"Export"})]})]})]})}),e.jsx("div",{className:"mb-8",children:e.jsx(j,{})}),e.jsxs(i,{className:"relative overflow-hidden border-0 bg-card/60 backdrop-blur-sm",style:{boxShadow:"var(--premium-shadow-subtle)",background:"linear-gradient(135deg, hsl(var(--card) / 0.8) 0%, hsl(var(--card) / 0.6) 100%)",border:"1px solid hsl(var(--premium-border))"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none"}),e.jsx(o,{className:"relative z-10",children:e.jsxs(d,{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-primary/10 to-primary/5",children:e.jsx(l,{className:"h-5 w-5 text-primary/70"})}),e.jsx("span",{children:"Call History"}),e.jsxs(u,{variant:"secondary",className:"ml-auto",children:[r.length," calls"]})]})}),e.jsxs(c,{className:"relative z-10",children:[t&&e.jsxs("div",{className:"text-center py-8 text-destructive",children:[e.jsxs("p",{children:["Failed to load call data: ",t]}),e.jsx(m,{variant:"outline",onClick:n,className:"mt-2",children:"Try Again"})]}),!t&&0===r.length&&!a&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(s,{className:"h-12 w-12 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No calls yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Your Twilio integration is ready! Test it by calling:"}),e.jsx("div",{className:"inline-block p-3 bg-primary/10 rounded-lg border border-primary/20",children:e.jsx("span",{className:"text-lg font-mono text-primary",children:"+1-587-742-8885"})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm text-muted-foreground",children:[e.jsx("p",{children:"✓ Voice webhooks configured"}),e.jsx("p",{children:"✓ Call forwarding to +1-431-990-0222"}),e.jsx("p",{children:"✓ Real-time call monitoring active"})]})]}),r.length>0&&e.jsx("div",{className:"space-y-3",children:r.map(r=>{const a=r.from_number.replace("+1","").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3");return e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-gradient-to-r from-muted/20 to-muted/10 hover:from-muted/30 hover:to-muted/20 border border-transparent hover:border-primary/10 transition-all duration-300",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(s,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-foreground",children:a}),e.jsx(u,{variant:"outline",className:`text-xs ${w(r.call_status)}`,children:r.call_status}),e.jsx(u,{variant:"secondary",className:"text-xs",children:r.direction})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[e.jsx("span",{children:f(r.created_at)}),e.jsxs("span",{children:["Duration: ",x(r.duration)]}),r.answered_by&&e.jsxs("span",{children:["Answered by: ",r.answered_by]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[r.recording_url&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>window.open(r.recording_url,"_blank"),className:"flex items-center space-x-1",children:[e.jsx(b,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:"Recording"})]}),e.jsx("div",{className:"text-xs text-muted-foreground font-mono",children:r.call_sid.slice(-8)})]})]},r.call_sid)})})]})]})]})})]})}export{N as default};
